counter=0,idList=new Array,chatroombox=null;var lang={online:"Online Users",whos:"Who's online",chatroom:"Chatroom",chatroom_header:"Common Chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard"};define(["jquery","jqueryui","local_vmchat/iolib","local_vmchat/chatboxManager","local_vmchat/clib","local_vmchat/footer","local_vmchat/uichatlist","local_vmchat/uichatbox"],function(a,b,c,d,e){return jQuery=a,{init:function(b){if("undefined"!=typeof id&&"undefined"!=typeof fname){var f="myCss";if(!document.getElementById(f)){var g=document.getElementsByTagName("head")[0],h=document.createElement("link");h.id=f,h.rel="stylesheet",h.type="text/css",h.href=b+"local/vmchat/bundle/chat/bundle/jquery/css/base/jquery-ui.css",h.media="all",g.appendChild(h)}var f="myCss1";if(!document.getElementById(f)){var g=document.getElementsByTagName("head")[0],h=document.createElement("link");h.id=f,h.rel="stylesheet",h.type="text/css",h.href=b+"local/vmchat/bundle/chat/css/jquery.ui.chatbox.css",h.media="all",g.appendChild(h)}vcJQuery=jQuery,a.uiBackCompat=!1;var i={userid:id,name:fname,lname:lname,img:imageurl},j=tk+"-main-c-room";dataobject={userid:id,sid:sid,rid:path,authuser:auth_user,authpass:auth_pass,userobj:i,room:j},a(document).ready(function(){counter=0,idList=new Array;return a.htab=[],a.htabIndex=[],vmstorage={},"false"!=localStorage.getItem("init")&&c.init(dataobject),"function"!=typeof a("body").footerbar&&a.extend(vcJQuery),a("body").footerbar(),"false"==localStorage.getItem("init")&&(a("#stickybar").removeClass("maximize").addClass("minimize"),a("#hide_bar input").removeClass("close").addClass("expand")),tabs=a("#tabs").tabs({cache:!0,activeOnAdd:!0}),0==e.browserSupportsLocalStorage()?void e.display_error(lang.sterror):(null!=localStorage.getItem(sid)&&(e.displayChatHistory(),vmstorage=JSON.parse(localStorage.getItem(sid))),sessionStorage.length>0&&e.displaycomChatHistory(),a("#tabs").delegate("span.ui-icon-close","click",function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("option").boxClosed(b),a("div#cb"+b+".ui-widget").hide();var c=a(this).closest("li").remove().attr("aria-controls");a("#"+c).remove(),delete vmstorage[b]}),a("#tabs").on("click","li a",function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("toggleContentbox"),"hidden"==localStorage.getItem(b)?localStorage.removeItem(b):localStorage.setItem(b,"hidden")}),a("ul.tabs").on("click","li",function(){a("li[aria-controls = '"+a(this).attr("id")+"']").removeClass("ui-state-highlight")}),a(document).on("member_added",function(a){e.memberUpdate(a)}),a(document).on("member_removed",function(a){e.memberUpdate(a)}),a(document).on("newmessage",function(a){e.messageUpdate(a)}),a(document).on("Multiple_login",function(b){a(".ui-memblist").remove(),a(".ui-chatbox").remove(),a("div#chatrm").remove(),chatroombox=null;for(key in c.uniquesids)key!=c.cfg.userid&&(d.delBox(key),a("li#tabcb"+key).remove());idList=new Array,a("#stickybar").removeClass("maximize").addClass("minimize"),a("#hide_bar input").removeClass("close").addClass("expand"),a("#hide_bar input").prop("title","Open chat"),tabs.tabs("refresh")}),a(document).on("authentication_failed",function(a){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",display_error(a.message)}),a(document).on("error",function(a){"object"!=typeof a.message&&e.display_error(a.message)}),a(document).on("connectionclose",function(c){a("#user_list .inner_bt #usertab_icon").css({background:"url("+b+"local/vmchat/bundle/chat/images/offline.png)no-repeat top left"}),a("#user_list .inner_bt #usertab_text").text(lang.whos+" (0)"),a("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" (0)"),a("div#memlist").css("display","none")}),void(e.isIosDevices()?a(window).unload(function(){var a=JSON.stringify(vmstorage);localStorage.setItem(sid,a)}):a(window).bind("beforeunload",function(){var a=JSON.stringify(vmstorage);localStorage.setItem(sid,a)})))})}}}});